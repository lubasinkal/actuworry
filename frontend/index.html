<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actuworry - Life Insurance Actuarial Platform</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#7C3AED',
                    }
                }
            }
        }
    </script>
    
    <style>
        [x-cloak] { display: none !important; }
        .chart-container { position: relative; height: 400px; }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .chart-container { height: 300px; }
            
            /* Better touch targets for mobile */
            button, input, select {
                min-height: 44px;
            }
            
            /* Prevent horizontal scroll on small screens */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Stack buttons on mobile */
            .flex.gap-4 {
                flex-direction: column;
            }
            
            .flex.gap-4 > button {
                width: 100%;
            }
        }
        
        /* Ensure tables are scrollable on mobile */
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body class="bg-gray-50 overflow-x-hidden" x-data="actuarialApp()">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center flex-shrink-0">
                    <h1 class="text-lg sm:text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                        üáßüáº Actuworry
                    </h1>
                    <span class="hidden sm:inline-block ml-3 text-sm text-gray-500">Life Insurance Actuarial Platform</span>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-4">
                    <button @click="activeTab = 'calculator'" 
                            :class="activeTab === 'calculator' ? 'text-primary border-b-2 border-primary' : 'text-gray-600'"
                            class="px-3 py-2 font-medium">
                        Calculator
                    </button>
                    <button @click="activeTab = 'portfolio'" 
                            :class="activeTab === 'portfolio' ? 'text-primary border-b-2 border-primary' : 'text-gray-600'"
                            class="px-3 py-2 font-medium">
                        Portfolio
                    </button>
                    <button @click="activeTab = 'sensitivity'" 
                            :class="activeTab === 'sensitivity' ? 'text-primary border-b-2 border-primary' : 'text-gray-600'"
                            class="px-3 py-2 font-medium">
                        Sensitivity
                    </button>
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" 
                            class="inline-flex items-center justify-center p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary">
                        <span class="sr-only">Open main menu</span>
                        <!-- Hamburger icon -->
                        <svg x-show="!mobileMenuOpen" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <!-- Close icon -->
                        <svg x-show="mobileMenuOpen" x-cloak class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div x-show="mobileMenuOpen" x-cloak 
             @click.away="mobileMenuOpen = false"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             class="md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-white border-t border-gray-200">
                <button @click="activeTab = 'calculator'; mobileMenuOpen = false" 
                        :class="activeTab === 'calculator' ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'"
                        class="block w-full text-left px-3 py-2 rounded-md text-base font-medium">
                    Calculator
                </button>
                <button @click="activeTab = 'portfolio'; mobileMenuOpen = false" 
                        :class="activeTab === 'portfolio' ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'"
                        class="block w-full text-left px-3 py-2 rounded-md text-base font-medium">
                    Portfolio
                </button>
                <button @click="activeTab = 'sensitivity'; mobileMenuOpen = false" 
                        :class="activeTab === 'sensitivity' ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'"
                        class="block w-full text-left px-3 py-2 rounded-md text-base font-medium">
                    Sensitivity
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Calculator Tab -->
        <div x-show="activeTab === 'calculator'" x-cloak>
            <div class="bg-white rounded-lg shadow-xl p-6">
                <h2 class="text-2xl font-bold mb-3 text-gray-800">Premium Calculator</h2>
                <p class="text-gray-600 mb-6">
                    Calculate life insurance premiums based on your age, coverage amount, and other factors. 
                    The calculator shows both the <span class="font-medium">net premium</span> (pure insurance cost) 
                    and <span class="font-medium">gross premium</span> (total cost including expenses and profit).
                </p>
                
                <!-- Product Type Explanation -->
                <div x-show="policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity'" 
                     class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div x-show="policy.product_type === 'immediate_annuity'">
                        <h4 class="font-semibold text-blue-900 mb-2">üí∞ Immediate Annuity</h4>
                        <p class="text-sm text-blue-800">
                            An immediate annuity provides regular income payments starting right away. 
                            Specify your desired annual income, and the calculator will determine the single lump sum required to purchase this annuity.
                            Perfect for retirement income or guaranteed cash flow.
                        </p>
                        <p class="text-xs text-blue-700 mt-2">
                            <strong>Example:</strong> To receive BWP 10,000 annually for the next 10 years, you might need to pay BWP 85,000 today (depending on age and rates).
                        </p>
                    </div>
                    <div x-show="policy.product_type === 'deferred_annuity'">
                        <h4 class="font-semibold text-blue-900 mb-2">‚è≥ Deferred Annuity</h4>
                        <p class="text-sm text-blue-800">
                            A deferred annuity provides regular income payments starting after a waiting period. 
                            Specify your desired annual income, and the calculator will determine the premiums needed during the accumulation phase.
                            Ideal for retirement planning when you want income to start later.
                        </p>
                        <p class="text-xs text-blue-700 mt-2">
                            <strong>Example:</strong> To receive BWP 10,000 annually after a 5-year deferral, you'll need to pay calculated premiums during the accumulation phase.
                        </p>
                    </div>
                </div>
                
                <form @submit.prevent="calculatePremium()">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Basic Information -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                            <input type="number" x-model.number="policy.age" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   min="18" max="80" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                            <select x-model="policy.table_name" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Product Type</label>
                            <select x-model="policy.product_type" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="term_life">Term Life</option>
                                <option value="whole_life">Whole Life</option>
                                <option value="immediate_annuity">Immediate Annuity</option>
                                <option value="deferred_annuity">Deferred Annuity</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <span x-text="(policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity') ? 'Annual Income Desired (BWP)' : 'Coverage Amount (BWP)'"></span>
                            </label>
                            <input type="number" x-model.number="policy.sum_assured" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   min="10000" step="1000" required>
                            <p class="text-xs text-gray-500 mt-1" x-show="policy.product_type === 'immediate_annuity'">
                                Annual payment amount you want to receive
                            </p>
                            <p class="text-xs text-gray-500 mt-1" x-show="policy.product_type === 'deferred_annuity'">
                                Annual payment amount you want to receive after deferral
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <span x-text="policy.product_type === 'whole_life' ? 'Premium Paying Period' : 'Term'"></span> (years)
                            </label>
                            <input type="number" x-model.number="policy.term" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   min="1" max="40" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Interest Rate (%)</label>
                            <input type="number" x-model.number="policy.interest_rate" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   min="0" max="20" step="0.1" required>
                        </div>
                        
                        <!-- Underwriting Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Smoker Status</label>
                            <select x-model="policy.smoker_status" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Unknown</option>
                                <option value="non_smoker">Non-smoker</option>
                                <option value="smoker">Smoker</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Health Rating</label>
                            <select x-model="policy.health_rating" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Standard</option>
                                <option value="preferred">Preferred</option>
                                <option value="substandard">Substandard</option>
                            </select>
                        </div>
                        
                        <div x-show="policy.product_type === 'deferred_annuity'">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Deferral Period (years)</label>
                            <input type="number" x-model.number="policy.deferral_period" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                   min="1" max="30">
                        </div>
                    </div>
                    
                    <div class="mt-6 flex flex-col sm:flex-row gap-4">
                        <button type="submit" 
                                class="px-6 py-3 bg-primary text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors"
                                :disabled="loading">
                            <span x-show="!loading">Calculate Premium</span>
                            <span x-show="loading">Calculating...</span>
                        </button>
                        <button type="button" @click="resetForm()" 
                                class="px-6 py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors">
                            Reset
                        </button>
                    </div>
                </form>
                
                <!-- Results Section -->
                <div x-show="result" x-cloak class="mt-8">
                    <h3 class="text-xl font-bold mb-2 text-gray-800">Calculation Results</h3>
                    <p class="text-sm text-gray-600 mb-4" x-show="policy.product_type === 'term_life' || policy.product_type === 'whole_life'">
                        These are your annual premium amounts. You'll pay the <span class="font-medium">Gross Premium</span> each year to keep your policy active.
                    </p>
                    <p class="text-sm text-gray-600 mb-4" x-show="policy.product_type === 'immediate_annuity'">
                        This immediate annuity requires a single lump-sum payment, and you'll receive annual income payments starting immediately.
                    </p>
                    <p class="text-sm text-gray-600 mb-4" x-show="policy.product_type === 'deferred_annuity'">
                        This deferred annuity requires premium payments during the accumulation phase. 
                        After the deferral period, you'll receive regular annual income payments.
                    </p>
                    
                    <!-- Annuity-specific results -->
                    <div x-show="policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity'" class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Annual Income Payment -->
                            <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg">
                                <h4 class="text-lg font-semibold text-green-900">Annual Income Payment</h4>
                                <p class="text-3xl font-bold text-green-700 mt-2">
                                    BWP <span x-text="formatNumber(result.annual_payout || policy.sum_assured)"></span>
                                </p>
                                <p class="text-sm text-green-600 mt-1">Amount you'll receive each year</p>
                                <p class="text-xs text-green-500 mt-2" x-show="policy.product_type === 'immediate_annuity'">
                                    üíµ Payments start immediately
                                </p>
                                <p class="text-xs text-green-500 mt-2" x-show="policy.product_type === 'deferred_annuity'">
                                    ‚è±Ô∏è Payments start after <span x-text="policy.deferral_period || 5"></span> years
                                </p>
                            </div>
                            
                            <!-- Total Cost -->
                            <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-lg">
                                <h4 class="text-lg font-semibold text-indigo-900">
                                    <span x-text="policy.product_type === 'immediate_annuity' ? 'Single Premium Required' : 'Total Premium Cost'"></span>
                                </h4>
                                <p class="text-3xl font-bold text-indigo-700 mt-2">
                                    BWP <span x-text="formatNumber(result.total_premium_cost || result.gross_premium)"></span>
                                </p>
                                <p class="text-sm text-indigo-600 mt-1" x-show="policy.product_type === 'immediate_annuity'">
                                    One-time payment to purchase annuity
                                </p>
                                <p class="text-sm text-indigo-600 mt-1" x-show="policy.product_type === 'deferred_annuity'">
                                    Total cost during accumulation phase
                                </p>
                                <p class="text-xs text-indigo-500 mt-2">
                                    üìä Includes all fees and expenses
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Life Insurance Premium Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" x-show="policy.product_type === 'term_life' || policy.product_type === 'whole_life'">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-blue-900">Net Premium</h4>
                            <p class="text-3xl font-bold text-blue-700 mt-2">
                                BWP <span x-text="formatNumber(result.net_premium)"></span>
                            </p>
                            <p class="text-sm text-blue-600 mt-1">Pure cost of insurance risk</p>
                            <p class="text-xs text-blue-500 mt-2">
                                üí° This covers only the expected claims based on mortality risk
                            </p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-purple-900">Gross Premium</h4>
                            <p class="text-3xl font-bold text-purple-700 mt-2">
                                BWP <span x-text="formatNumber(result.gross_premium)"></span>
                            </p>
                            <p class="text-sm text-purple-600 mt-1">Total amount you pay annually</p>
                            <p class="text-xs text-purple-500 mt-2">
                                üí≥ Includes insurance cost + company expenses + profit margin
                            </p>
                        </div>
                    </div>
                    
                    <!-- Charts Section (only for life insurance) -->
                    <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6" x-show="policy.product_type === 'term_life' || policy.product_type === 'whole_life'">
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-2">Reserve Schedule</h4>
                            <p class="text-xs text-gray-500 mb-3">
                                üìà Money set aside each year to pay future claims
                            </p>
                            <div class="chart-container">
                                <canvas id="reserveChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-2">Premium Breakdown</h4>
                            <p class="text-xs text-gray-500 mb-3">
                                ü•ß How your premium is divided between risk, expenses, and profit
                            </p>
                            <div class="chart-container">
                                <canvas id="premiumChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculation Assumptions for All Products -->
                    <div x-show="result" class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-900 mb-3">üìä Calculation Assumptions</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Your Age:</span>
                                    <span class="font-medium" x-text="policy.age + ' years'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Gender:</span>
                                    <span class="font-medium capitalize" x-text="policy.table_name"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600" x-text="(policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity') ? 'Payment Term:' : (policy.product_type === 'whole_life' ? 'Premium Paying Period:' : 'Policy Term:')"></span>
                                    <span class="font-medium" x-text="policy.term + ' years'"></span>
                                </div>
                                <div class="flex justify-between" x-show="policy.product_type === 'deferred_annuity'">
                                    <span class="text-gray-600">Deferral Period:</span>
                                    <span class="font-medium" x-text="(policy.deferral_period || 5) + ' years'"></span>
                                </div>
                                <div class="flex justify-between" x-show="policy.product_type === 'term_life' || policy.product_type === 'whole_life'">
                                    <span class="text-gray-600">Coverage Amount:</span>
                                    <span class="font-medium" x-text="'BWP ' + formatNumber(policy.sum_assured)"></span>
                                </div>
                                <div class="flex justify-between" x-show="policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity'">
                                    <span class="text-gray-600">Annual Income:</span>
                                    <span class="font-medium" x-text="'BWP ' + formatNumber(policy.sum_assured)"></span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Interest Rate:</span>
                                    <span class="font-medium" x-text="policy.interest_rate + '%'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Health Status:</span>
                                    <span class="font-medium capitalize" x-text="policy.health_rating || 'Standard'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Smoker Status:</span>
                                    <span class="font-medium" x-text="policy.smoker_status ? (policy.smoker_status === 'smoker' ? 'Smoker' : 'Non-smoker') : 'Unknown'"></span>
                                </div>
                                <div class="flex justify-between" x-show="policy.product_type === 'immediate_annuity' || policy.product_type === 'deferred_annuity'">
                                    <span class="text-gray-600">Expense Loading:</span>
                                    <span class="font-medium">10%</span>
                                </div>
                                <div class="flex justify-between" x-show="policy.product_type === 'whole_life'">
                                    <span class="text-gray-600">Coverage Type:</span>
                                    <span class="font-medium">Lifetime</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs text-gray-500">
                                <span class="font-medium">Note:</span> 
                                <span x-show="policy.product_type === 'term_life'">Calculations use mortality tables based on your gender and age, adjusted for health and smoking status. Coverage provides death benefit protection for the specified term.</span>
                                <span x-show="policy.product_type === 'whole_life'">Calculations use mortality tables based on your gender and age, adjusted for health and smoking status. Coverage provides lifetime death benefit protection with premiums paid over the specified period.</span>
                                <span x-show="policy.product_type === 'immediate_annuity'">Calculations use mortality tables based on your gender and age, adjusted for health and smoking status. Payments begin immediately and continue for the specified term.</span>
                                <span x-show="policy.product_type === 'deferred_annuity'">Calculations use mortality tables based on your gender and age, adjusted for health and smoking status. Payments begin after the deferral period and continue for the specified term.</span>
                            </p>
                        </div>
                    </div>
                    
                    <!-- Expense Details -->
                    <div x-show="result.expenses" class="mt-6 bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-900 mb-2">Expense Structure</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-yellow-700">Initial:</span>
                                <span class="font-medium" x-text="(result.expenses.initial_expense_rate * 100).toFixed(1) + '%'"></span>
                            </div>
                            <div>
                                <span class="text-yellow-700">Renewal:</span>
                                <span class="font-medium" x-text="(result.expenses.renewal_expense_rate * 100).toFixed(1) + '%'"></span>
                            </div>
                            <div>
                                <span class="text-yellow-700">Maintenance:</span>
                                <span class="font-medium">BWP <span x-text="result.expenses.maintenance_expense"></span></span>
                            </div>
                            <div>
                                <span class="text-yellow-700">Profit Margin:</span>
                                <span class="font-medium" x-text="(result.expenses.profit_margin * 100).toFixed(1) + '%'"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Portfolio Tab -->
        <div x-show="activeTab === 'portfolio'" x-cloak>
            <div class="bg-white rounded-lg shadow-xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Portfolio Analysis</h2>
                
                <div class="mb-6">
                    <button @click="addPolicyToPortfolio()" 
                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        + Add Policy
                    </button>
                    <button @click="analyzePortfolio()" 
                            class="ml-3 px-4 py-2 bg-primary text-white rounded-lg hover:bg-indigo-700 transition-colors"
                            :disabled="portfolio.length === 0">
                        Analyze Portfolio
                    </button>
                </div>
                
                <!-- Portfolio Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Age</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gender</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coverage</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Term</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="(policy, index) in portfolio" :key="index">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="policy.age"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="policy.table_name"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="policy.product_type"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="formatNumber(policy.sum_assured)"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="policy.term"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <button @click="portfolio.splice(index, 1)" 
                                                class="text-red-600 hover:text-red-900">Remove</button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <!-- Portfolio Results -->
                <div x-show="portfolioResult" x-cloak class="mt-8">
                    <h3 class="text-xl font-bold mb-4">Portfolio Metrics</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700">Total Policies</h4>
                            <p class="text-2xl font-bold" x-text="portfolioResult.total_policies"></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700">Total Net Premium</h4>
                            <p class="text-2xl font-bold">BWP <span x-text="formatNumber(portfolioResult.total_net_premium)"></span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700">Total Gross Premium</h4>
                            <p class="text-2xl font-bold">BWP <span x-text="formatNumber(portfolioResult.total_gross_premium)"></span></p>
                        </div>
                    </div>
                    
                    <!-- Portfolio Charts -->
                    <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-4">Product Distribution</h4>
                            <div style="height: 300px;">
                                <canvas id="productChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-4">Risk Distribution</h4>
                            <div style="height: 300px;">
                                <canvas id="riskChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sensitivity Tab -->
        <div x-show="activeTab === 'sensitivity'" x-cloak>
            <div class="bg-white rounded-lg shadow-xl p-6">
                <h2 class="text-2xl font-bold mb-3 text-gray-800">Sensitivity Analysis</h2>
                <p class="text-gray-600 mb-6">
                    <span class="text-blue-600 font-medium">What is this?</span> 
                    Sensitivity analysis shows how changes in different factors (like age or interest rates) affect your insurance premium. 
                    This helps you understand which factors have the biggest impact on cost.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-3 text-lg">üìã Base Policy Details</h3>
                        <p class="text-sm text-gray-500 mb-4">Enter the baseline policy to analyze</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Policyholder Age</label>
                                <input type="number" x-model.number="sensitivityPolicy.age" 
                                       class="w-full px-3 py-2 border rounded-lg" min="18" max="80">
                                <p class="text-xs text-gray-500 mt-1">Current age of the person being insured</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Coverage Amount (BWP)</label>
                                <input type="number" x-model.number="sensitivityPolicy.sum_assured" 
                                       class="w-full px-3 py-2 border rounded-lg" min="10000" step="1000">
                                <p class="text-xs text-gray-500 mt-1">Amount paid to beneficiaries upon death</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Policy Term (years)</label>
                                <input type="number" x-model.number="sensitivityPolicy.term" 
                                       class="w-full px-3 py-2 border rounded-lg" min="1" max="40">
                                <p class="text-xs text-gray-500 mt-1">How long the insurance coverage lasts</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                <input type="number" x-model.number="sensitivityPolicy.interest_rate" 
                                       class="w-full px-3 py-2 border rounded-lg" min="0" max="20" step="0.1">
                                <p class="text-xs text-gray-500 mt-1">Expected investment return rate</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-3 text-lg">üìä Test Different Scenarios</h3>
                        <p class="text-sm text-gray-500 mb-4">Enter values to test (separate with commas)</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Interest Rate Scenarios (%)
                                    <span class="text-gray-500 font-normal"> - How market rates affect premiums</span>
                                </label>
                                <input type="text" x-model="sensitivityParams.interest_rates" 
                                       value="3,4,5,6,7" 
                                       class="w-full px-3 py-2 border rounded-lg">
                                <p class="text-xs text-gray-500 mt-1">Example: 3,4,5,6,7 tests rates from 3% to 7%</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Age Scenarios (years)
                                    <span class="text-gray-500 font-normal"> - How age affects premiums</span>
                                </label>
                                <input type="text" x-model="sensitivityParams.ages" 
                                       value="30,35,40,45,50" 
                                       class="w-full px-3 py-2 border rounded-lg">
                                <p class="text-xs text-gray-500 mt-1">Example: 30,35,40,45,50 tests different ages</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Coverage Amount Scenarios (BWP)
                                    <span class="text-gray-500 font-normal"> - How coverage affects premiums</span>
                                </label>
                                <input type="text" x-model="sensitivityParams.coverage_amounts" 
                                       value="50000,100000,150000,200000" 
                                       class="w-full px-3 py-2 border rounded-lg">
                                <p class="text-xs text-gray-500 mt-1">Example: 50000,100000,150000,200000</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button @click="runSensitivityAnalysis()" 
                        class="mt-6 px-6 py-3 bg-primary text-white rounded-lg hover:bg-indigo-700 transition-colors">
                    Run Sensitivity Analysis
                </button>
                
                <!-- Sensitivity Results -->
                <div x-show="sensitivityResult" x-cloak class="mt-8">
                    <h3 class="text-xl font-bold mb-4">Sensitivity Results</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-4">Interest Rate Sensitivity</h4>
                            <div style="height: 300px;">
                                <canvas id="interestSensitivityChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg border border-gray-200">
                            <h4 class="text-lg font-semibold mb-4">Age Sensitivity</h4>
                            <div style="height: 300px;">
                                <canvas id="ageSensitivityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer with Disclaimer -->
    <footer class="bg-black text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-3">Data Source & Disclaimer</h3>
                    <p class="text-sm text-gray-300 mb-2">
                        This calculator uses mortality data from the UK Office for National Statistics (ONS) 
                        2021-2023 National Life Tables. 2023 Data used.
                    </p>
                    <p class="text-xs text-gray-400 mb-3">
                        <strong>Note:</strong> These calculations are for educational and demonstration purposes only. 
                        Actual insurance premiums will vary based on individual circumstances, insurer practices, 
                        and market conditions. Please consult with a qualified insurance professional for actual quotes.
                    </p>
                    <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/lifeexpectancies/datasets/nationallifetablesunitedkingdomreferencetables" 
                       target="_blank" 
                       class="text-blue-400 hover:text-blue-300 text-xs underline">
                        View ONS National Life Tables ‚Üí
                    </a>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3">About Actuworry</h3>
                    <p class="text-sm text-gray-300 mb-3">
                        Actuworry is an open-source life insurance actuarial platform designed for 
                        educational purposes and actuarial calculations. Built with Go backend and 
                        modern web technologies.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <a href="https://github.com/lubasinkal/actuworry" 
                           target="_blank" 
                           class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                            View on GitHub
                        </a>
                        <span class="text-gray-500 text-sm">
                            Created by <span class="text-gray-300">lubasinkal. Explore my corner of the universe at 

                                    <a href="https//lubasiverse.pages.dev"> lubasiverse</a>
                                </span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-gray-700 text-center">
                <p class="text-xs text-gray-400">
                    ¬© 2025 Actuworry. Educational use only. Not for commercial insurance decisions.
                    <br>
                    Data ¬© Crown copyright 2025 - UK Office for National Statistics. Used under Open Government Licence v3.0.
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Alpine.js Application -->
    <script src="js/app.js"></script>
</body>
</html>
